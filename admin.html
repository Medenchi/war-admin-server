<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–ê–¥–º–∏–Ω–∫–∞ SigmaGamblers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet"/>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Montserrat', sans-serif;
            background: #111;
            color: #fff;
            line-height: 1.6;
            padding: 40px;
        }

        .dashboard {
            max-width: 500px;
            margin: auto;
            background: #222;
            padding: 30px;
            border-radius: 10px;
        }

        input, textarea, button, select {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            font-size: 14px;
        }

        button {
            background: #ff6b6b;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        h2.section-title {
            text-align: center;
            margin-top: 30px;
            color: #ff6b6b;
        }

        .preview-container {
            margin-top: 20px;
            text-align: center;
        }

        .preview-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #555;
            border-radius: 8px;
        }

        .hidden {
            display: none !important;
        }

        .list-item {
            background: #333;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }

        .actions {
            margin-top: 10px;
        }

        .actions button {
            margin-right: 5px;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        .watermark-settings {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .watermark-preview {
            margin-top: 10px;
            text-align: center;
        }

        .watermark-preview img {
            max-width: 100%;
            height: auto;
        }

        .edit-form {
            margin-top: 20px;
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
        }

        .edit-form input, .edit-form textarea {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
        }

        .edit-form button {
            margin-top: 10px;
        }

        .block-list {
            margin-top: 20px;
        }

        .block-item {
            background: #333;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .block-controls {
            margin-top: 10px;
        }

        .block-controls button {
            margin-right: 10px;
        }
    </style>
</head>
<body>

<div class="dashboard">

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ -->
    <h2 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞</h2>
    <div class="watermark-settings">
        <input type="file" id="wmLogoFile" accept="image/*" onchange="previewWmLogo()">
        <img id="currentWmLogo" src="" alt="–õ–æ–≥–æ—Ç–∏–ø –¥–ª—è –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞" width="60" style="margin-top:10px;">
        <label for="wmText">–¢–µ–∫—Å—Ç –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞:</label>
        <input type="text" id="wmText" value="SigmaGamblers" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: SigmaGamblers">
        <label for="wmOpacity">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</label>
        <input type="range" id="wmOpacity" min="0.05" max="0.5" step="0.05" value="0.2">
        <span id="opacityValue">0.2</span><br>
        <button onclick="saveWatermarkSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞</button>
    </div><hr>

    <!-- –ë–ª–æ–∫ –í–æ—Ç–µ—Ä–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–∫–∞ -->
    <h2 class="section-title">–í–û–¢–ï–†–ü–†–ï–û–ë–†–ê–ó–û–í–ê–õ–ö–ê</h2>
    <input type="file" id="waterImageInput" accept="image/*" onchange="previewWatermarked()">
    <select id="targetBlock" onchange="handleTargetSelect()">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–π –±–ª–æ–∫</option>
        <option value="reviews">–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Ç–∑—ã–≤—ã</option>
        <option value="services">–î–æ–±–∞–≤–∏—Ç—å –≤ —É—Å–ª—É–≥–∏</option>
        <option value="portfolio">–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</option>
    </select>

    <div class="preview-container">
        <p>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</p>
        <img id="waterPreview" src="" alt="–° –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º" style="display:none;">
    </div>

    <div id="form-review" class="edit-form hidden">
        <h3>–§–æ—Ä–º–∞: –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
        <textarea id="reviewText_WM" placeholder="–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞"></textarea>
        <input type="text" id="reviewAuthor_WM" placeholder="–ò–º—è –∞–≤—Ç–æ—Ä–∞">
        <input type="number" id="reviewRating_WM" min="1" max="5" step="0.1" placeholder="–†–µ–π—Ç–∏–Ω–≥ (1-5)">
        <button onclick="saveToReview()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ—Ç–∑—ã–≤—ã</button>
    </div>

    <div id="form-service" class="edit-form hidden">
        <h3>–§–æ—Ä–º–∞: –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</h3>
        <input type="text" id="serviceName_WM" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏">
        <textarea id="serviceDescription_WM" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏"></textarea>
        <button onclick="saveToService()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —É—Å–ª—É–≥–∏</button>
    </div>

    <div id="form-portfolio" class="edit-form hidden">
        <h3>–§–æ—Ä–º–∞: –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É</h3>
        <button onclick="saveToPortfolio()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</button>
    </div>

    <button onclick="applyAndConvertCurrent()">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –í–ú</button>
    <div class="watermark-preview" id="watermarkPreviewContainer"></div><hr>

    <!-- –û—Ç–∑—ã–≤—ã -->
    <h2 class="section-title">–û—Ç–∑—ã–≤—ã</h2>
    <div id="reviewsList" class="block-list"></div><hr>

    <!-- –£—Å–ª—É–≥–∏ -->
    <h2 class="section-title">–£—Å–ª—É–≥–∏</h2>
    <div id="servicesList" class="block-list"></div><hr>

    <!-- –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ -->
    <h2 class="section-title">–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ</h2>
    <div id="portfolioList" class="block-list"></div><hr>

    <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
    <h2 class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
    <textarea id="contactInfo">Telegram: @yourusername<br>Email: example@example.com</textarea>
    <button onclick="saveContacts()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script>
    // üîë Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyCDaptwQubkzkAkHSSi_GpMhRHFasWFXvw",
        authDomain: "moonstudio-db.firebaseapp.com",
        databaseURL: "https://moonstudio-db-default-rtdb.firebaseio.com",
        projectId: "moonstudio-db",
        storageBucket: "moonstudio-db.firebasestorage.app",
        messagingSenderId: "154686593917",
        appId: "1:154686593917:web:c777e00ae5096e048eca14"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function refPath(path) {
        return db.ref(path);
    }

    let currentWatermarkedData = null;
    let wmSettings = {
        logo: null,
        text: "SigmaGamblers",
        opacity: 0.2
    };

    // --- –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ ---
    function readFileAsDataURL(file, callback) {
        const reader = new FileReader();
        reader.onload = e => callback(e.target.result);
        reader.readAsDataURL(file);
    }

    // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ ---
    function saveWatermarkSettings() {
        const logoFile = document.getElementById("wmLogoFile").files[0];
        const text = document.getElementById("wmText").value || "SigmaGamblers";
        const opacity = parseFloat(document.getElementById("wmOpacity").value);

        if (logoFile) {
            readFileAsDataURL(logoFile, logoData => {
                wmSettings.logo = logoData;
                wmSettings.text = text;
                wmSettings.opacity = opacity;
                localStorage.setItem("wmSettings", JSON.stringify(wmSettings));
                alert("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!");
            });
        } else {
            wmSettings.text = text;
            wmSettings.opacity = opacity;
            localStorage.setItem("wmSettings", JSON.stringify(wmSettings));
            alert("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã");
        }
    }

    // --- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ—Ç–∏–ø–∞ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ ---
    function previewWmLogo() {
        const file = document.getElementById("wmLogoFile").files[0];
        if (!file) return;

        readFileAsDataURL(file, logoData => {
            document.getElementById("currentWmLogo").src = logoData;
        });
    }

    // --- –ù–∞–ª–æ–∂–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ ---
    async function applyWatermark(imageUrl, callback) {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("b2d");

        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = imageUrl;

        img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            // –¢–µ–∫—Å—Ç SigmaGamblers (—Ö–∞–æ—Ç–∏—á–Ω–æ)
            ctx.save();
            ctx.font = "bold 30px 'Press Start 2P'";
            ctx.fillStyle = `rgba(255, 255, 255, ${wmSettings.opacity})`;
            ctx.textAlign = "center";

            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                ctx.fillText(wmSettings.text, x, y);
            }

            ctx.restore();

            // –õ–æ–≥–æ—Ç–∏–ø –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
            if (wmSettings.logo) {
                const logo = new Image();
                logo.crossOrigin = "Anonymous";
                logo.onload = () => {
                    const size = Math.min(canvas.width, canvas.height) * 0.2;
                    ctx.globalAlpha = 0.2;
                    ctx.drawImage(logo, canvas.width - size - 20, canvas.height - size - 20, size, size);
                    ctx.globalAlpha = 1;

                    canvas.toBlob(blob => {
                        const reader = new FileReader();
                        reader.onload = () => callback(reader.result); // base64
                        reader.readAsDataURL(blob);
                    }, "image/png");
                };
                logo.src = wmSettings.logo;
            } else {
                canvas.toBlob(blob => {
                    const reader = new FileReader();
                    reader.onload = () => callback(reader.result); // base64
                    reader.readAsDataURL(blob);
                }, "image/png");
            }
        };
    }

    // --- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ ---
    function previewWatermarked() {
        const fileInput = document.getElementById("waterImageInput");
        if (!fileInput.files[0]) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");

        readFileAsDataURL(fileInput.files[0], imageData => {
            applyWatermark(imageData, watermarkedData => {
                document.getElementById("waterPreview").src = watermarkedData;
                document.getElementById("waterPreview").style.display = "block";
                currentWatermarkedData = watermarkedData;
            });
        });
    }

    // --- –í—ã–±–æ—Ä —Ü–µ–ª–µ–≤–æ–≥–æ –±–ª–æ–∫–∞ ---
    function handleTargetSelect() {
        const block = document.getElementById("targetBlock").value;

        document.querySelectorAll("[id^='form-']").forEach(el => el.classList.add("hidden"));

        if (block === "reviews") {
            document.getElementById("form-review").classList.remove("hidden");
        } else if (block === "services") {
            document.getElementById("form-service").classList.remove("hidden");
        } else if (block === "portfolio") {
            document.getElementById("form-portfolio").classList.remove("hidden");
        }
    }

    // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Ç–∑—ã–≤—ã —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º ---
    function saveToReview() {
        const text = document.getElementById("reviewText_WM").value.trim();
        const author = document.getElementById("reviewAuthor_WM").value.trim();
        const rating = parseFloat(document.getElementById("reviewRating_WM").value.trim());

        if (!text || !author || !rating || !currentWatermarkedData) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");
            return;
        }

        const id = Date.now();
        refPath(`reviews/${id}`).set({ text, author, rating, image: currentWatermarkedData }, err => {
            if (err) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞");
            } else {
                alert("–û—Ç–∑—ã–≤ –¥–æ–±–∞–≤–ª–µ–Ω —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º");
                loadReviews();
                clearFields(["reviewText_WM", "reviewAuthor_WM", "reviewRating_WM"]);
                document.getElementById("targetBlock").value = "";
                document.querySelectorAll("[id^='form-']").forEach(el => el.classList.add("hidden"));
                currentWatermarkedData = null;
            }
        });
    }

    // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —É—Å–ª—É–≥–∏ —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º ---
    function saveToService() {
        const title = document.getElementById("serviceName_WM").value.trim();
        const description = document.getElementById("serviceDescription_WM").value.trim();

        if (!title || !description || !currentWatermarkedData) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");
            return;
        }

        const id = Date.now();
        refPath(`services/${id}`).set({ title, description, image: currentWatermarkedData }, err => {
            if (err) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏");
            } else {
                alert("–£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º");
                loadServices();
                clearFields(["serviceName_WM", "serviceDescription_WM"]);
                document.getElementById("targetBlock").value = "";
                document.querySelectorAll("[id^='form-']").forEach(el => el.classList.add("hidden"));
                currentWatermarkedData = null;
            }
        });
    }

    // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º ---
    function saveToPortfolio() {
        if (!currentWatermarkedData) {
            alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");
            return;
        }

        const id = Date.now();
        refPath(`portfolio/${id}`).set({ image: currentWatermarkedData }, err => {
            if (err) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã");
            } else {
                alert("–†–∞–±–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º");
                loadPortfolio();
                document.getElementById("targetBlock").value = "";
                document.getElementById("form-portfolio").classList.add("hidden");
                currentWatermarkedData = null;
            }
        });
    }

    // --- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é ---
    function convertExistingToWatermark(url, path, key) {
        applyWatermark(url, data => {
            refPath(`${path}/${key}/image`).set(data, err => {
                if (err) {
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏");
                } else {
                    alert("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º");
                    loadReviews();
                    loadServices();
                    loadPortfolio();
                }
            });
        });
    }

    // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –í–ú" ---
    function applyAndConvertCurrent() {
        const selectedKey = document.getElementById("convertKey").value;
        const selectedType = document.getElementById("convertType").value;

        if (!selectedType || !selectedKey) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∏ –∫–ª—é—á —ç–ª–µ–º–µ–Ω—Ç–∞");
            return;
        }

        refPath(`${selectedType}/${selectedKey}`).once("value", snap => {
            const val = snap.val();
            if (!val || !val.image) {
                alert("–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è");
                return;
            }

            applyWatermark(val.image, data => {
                refPath(`${selectedType}/${selectedKey}/image`).set(data, err => {
                    if (err) {
                        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏");
                    } else {
                        alert("–§–æ—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º");
                        document.getElementById("convertKey").value = "";
                        document.getElementById("convertType").value = "";
                    }
                });
            });
        });
    }

    // --- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ---
    function loadReviews() {
        refPath("reviews").on("value", snapshot => {
            const container = document.getElementById("reviewsList");
            container.innerHTML = "<h3>–û—Ç–∑—ã–≤—ã</h3>";

            if (!snapshot.exists()) return;

            snapshot.forEach(child => {
                const r = child.val();
                const div = document.createElement("div");
                div.className = "block-item";
                div.innerHTML = `
                    "${r.text}" ‚Äî ${r.author}<br>
                    <small>–†–µ–π—Ç–∏–Ω–≥: ‚≠ê ${r.rating}</small><br>
                    <img src="${r.image}" width="100"><br>
                    <div class="block-controls">
                        <button onclick="convertExisting('${child.key}', 'reviews')">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –í–ú</button>
                        <button onclick="deleteBlock('${child.key}', 'reviews')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                container.appendChild(div);
            });
        });
    }

    function loadServices() {
        refPath("services").on("value", snapshot => {
            const container = document.getElementById("servicesList");
            container.innerHTML = "<h3>–£—Å–ª—É–≥–∏</h3>";

            if (!snapshot.exists()) return;

            snapshot.forEach(child => {
                const s = child.val();
                const div = document.createElement("div");
                div.className = "block-item";
                div.innerHTML = `
                    <strong>${s.title}</strong><br>${s.description}<br>
                    <img src="${s.image}" width="100"><br>
                    <div class="block-controls">
                        <button onclick="convertExisting('${child.key}', 'services')">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –í–ú</button>
                        <button onclick="deleteBlock('${child.key}', 'services')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>`;
                container.appendChild(div);
            });
        });
    }

    function loadPortfolio() {
        refPath("portfolio").on("value", snapshot => {
            const container = document.getElementById("portfolioList");
            container.innerHTML = "<h3>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ</h3>";

            if (!snapshot.exists()) return;

            snapshot.forEach(child => {
                const p = child.val();
                const div = document.createElement("div");
                div.className = "block-item";
                div.innerHTML = `<img src="${p.image}" width="100"><br>
                    <div class="block-controls">
                        <button onclick="convertExisting('${child.key}', 'portfolio')">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –í–ú</button>
                        <button onclick="deleteBlock('${child.key}', 'portfolio')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>`;
                container.appendChild(div);
            });
        });
    }

    function deleteBlock(id, type) {
        refPath(`${type}/${id}`).remove(() => {
            alert("–≠–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª—ë–Ω");
        });
    }

    function convertExisting(id, type) {
        document.getElementById("convertKey").value = id;
        document.getElementById("convertType").value = type;
    }

    // --- –ö–æ–Ω—Ç–∞–∫—Ç—ã ---
    function saveContacts() {
        const info = document.getElementById("contactInfo").value;
        refPath("contacts").set(info, err => {
            if (err) {
                alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤");
            } else {
                alert("–ö–æ–Ω—Ç–∞–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã");
            }
        });
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ ---
    function initWatermarkSettings() {
        const saved = localStorage.getItem("wmSettings");
        if (saved) {
            wmSettings = JSON.parse(saved);
            document.getElementById("wmText").value = wmSettings.text;
            document.getElementById("wmOpacity").value = wmSettings.opacity;
            document.getElementById("currentWmLogo").src = wmSettings.logo || "https://via.placeholder.com/60x60?text=SG";
        }
    }

    // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
    function clearFields(ids) {
        ids.forEach(id => document.getElementById(id).value = "");
    }

    window.onload = () => {
        document.getElementById("wmOpacity").addEventListener("input", e => {
            document.getElementById("opacityValue").innerText = e.target.value;
        });

        initWatermarkSettings();
        loadReviews();
        loadServices();
        loadPortfolio();

        refPath("contacts").once("value", snap => {
            document.getElementById("contactInfo").value = snap.val() || "Telegram: @yourusername<br>Email: example@example.com";
        });
    };
</script>

<!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è -->
<input type="text" id="convertKey" class="hidden">
<input type="text" id="convertType" class="hidden">

</body>
</html>
